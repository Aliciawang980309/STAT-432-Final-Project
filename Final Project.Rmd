---
title: "Top 1 Group Final Project"
author: "Hao Wang (haow12), Qiuning Ge (qiuning2), Chenhan Xu (chenhan2), and Zhongyu Wu (zhongyu6)"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document: 
    theme: cosmo
    toc: yes
  pdf_document: default
urlcolor: BrickRed
---

## Introduction

```{r, setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.align = 'center')
```

```{r, load-packages, include = FALSE, message = FALSE}
library(dplyr)
library(caret)
library(purrr)
library(ggplot2)
library(knitr)
library(kableExtra)
library(tidyverse)
library(car)
library(randomForest)
library(car)
```

```{r}
theme_set(theme_light())
```

***

# Abstract

> ABS

***

# Introduction

INTRO

***

# Methods

## Data

```{r, load-data}
bank_full = read.csv("bank-additional.csv")
```

```{r, exclude-unknown}
bank_new = bank_full %>%
  filter(
    bank_full$job != "unknown" &
      bank_full$marital != "unknown" &
      bank_full$education != "unknown" &
      bank_full$loan != "unknown" & bank_full$housing != "unknown")
```

```{r, split-data}
# set seed to reproduce split
set.seed(42)
# test-train split
idx = createDataPartition(bank_new$y, p = 0.8, list = FALSE)
bank_trn = bank_new[idx, ]
bank_tst = bank_new[-idx, ]
```

## Modeling

MODEL

### Evaluation

EVAL

### Binary Classification

CLASSIFICATION

***

# Results

RESULTS

***

# Discussion

DIS

***

# Appendix

## Data Dictionary

```{r, include = FALSE}
names(bank_trn)
```

- `age` - age in years
- `job` - type of job
- `marital` - marital status
- `education` - education level
- `default` - whether this client has credit in default
- `housing` - whether this client has housing loan
- `loan` - whether this client has personal loan
- `contact` - contact communication type
- `month` - last contact month of year
- `day_of_week` - last contact day of the week
- `duration` - last contact duration in seconds
- `campaign` - number of contacts performed during this campaign and for this client
- `pdays` - number of days that passed by after the client was last contacted from a previous campaign
- `previous` - number of contacts performed before this campaign and for this client
- `poutcome` - outcome of the previous marketing campaign
- `emp.var.rate` - employment variation rate
- `cons.price.idx` - consumer price index
- `cons.conf.idx` - consumer confidence index
- `euribor3m` - euribor 3 month rate
- `nr.employed` - number of employees
- `y` - whether the client has subscribed a term deposit?

See the UCI Machine Learning Repository for additional documentation.

## EDA

```{r}
bank_num = read.csv("bank-additional.csv")
bank_num[,] <- sapply(bank_full[,], as.numeric)
heatmap(x = as.matrix(bank_num))
full_model = lm(y ~ ., data = bank_num)
vif(full_model)
```

```{r}
plot_1 = bank_new %>%
  ggplot(aes(x = age, col = job)) +
  geom_density()

plot_2 = bank_new %>%
  ggplot(aes(x = education, fill = education)) +
  geom_bar() +
  coord_flip() +
  facet_wrap( ~ housing)

plot_3 = bank_new %>%
  ggplot(aes(x = cons.conf.idx, y = cons.price.idx, color = y)) +
  geom_point()

plot_4 = bank_new %>%
  ggplot(aes(x = age, col = loan)) +
  geom_density()

plot_5 = bank_new %>%
  ggplot(aes(x = age, col = month)) +
  geom_density()

plot_6 = bank_new %>%
  ggplot(aes(x = age, col = contact)) +
  geom_density()

plot_7 = bank_new %>%
  ggplot(aes(x = y, fill = education)) +
  geom_bar() +
  facet_wrap( ~ job)

plot_8 = bank_new %>%
  ggplot(aes(x = education, fill = y)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 45))

plot_9 = bank_new %>%
  ggplot(aes(x = job, fill = y)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 45))

plot_10 = bank_new %>%
  ggplot(aes(x = previous, fill = y)) +
  geom_bar()

  plot_11 = bank_new %>%
  ggplot(aes(x = emp.var.rate, y = euribor3m)) +
  geom_point()

plot_12 = bank_new %>%
  ggplot(aes(x = emp.var.rate, y = nr.employed)) +
  geom_point()

plot_13 = bank_new %>%
  ggplot(aes(x = euribor3m, y = nr.employed)) +
  geom_point()
```

```{r, print-eda-plots, fig.height = 10, fig.width = 17}
gridExtra::grid.arrange(plot_1, plot_2, plot_3, plot_4, plot_5, plot_6, plot_7, plot_8, plot_9, plot_10)
```

```{r}
bank_num = bank_full
bank_num[,] <- sapply(bank_full[,], as.numeric)
```

```{r}
rf = randomForest(y ~ ., data = bank_full)
```

```{r}
rf$importance
```

```{r}
cor(bank_full[, c("emp.var.rate", "cons.price.idx", "cons.conf.idx", "euribor3m", "nr.employed")])
```

```{r}
pca = prcomp(bank_full[, c("emp.var.rate", "cons.price.idx", "cons.conf.idx", "euribor3m")], center = TRUE, scale = TRUE)
plot(pca, type = "line")
as.matrix(pca$rotation[,1])
mat = scale(as.matrix(bank_full[, c("emp.var.rate", "cons.price.idx", "cons.conf.idx", "euribor3m", "nr.employed")]))
```

***
